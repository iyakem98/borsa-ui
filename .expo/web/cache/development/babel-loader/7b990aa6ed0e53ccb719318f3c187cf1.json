{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport axios from 'axios';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport io from 'socket.io-client';\nimport moment from 'moment';\nimport { API_BASE_URL } from \"../../utils/config\";\nvar API_URL = 'http://143.198.168.244/api/';\nvar ENDPOINT = \"http://192.168.100.2:5000\";\nvar register = function () {\n  var _ref = _asyncToGenerator(function* (userData) {\n    var _yield$axios$post = yield axios.post(API_URL + \"users\", userData),\n      data = _yield$axios$post.data;\n    try {\n      if (data) {\n        var user = yield AsyncStorage.setItem('user', JSON.stringify(data));\n        var user1 = yield AsyncStorage.getItem('user');\n        console.log(JSON.stringify(user1));\n        return data;\n      }\n    } catch (error) {\n      console.log('cannot register user');\n    }\n    return response.data;\n  });\n  return function register(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\nvar login = function () {\n  var _ref2 = _asyncToGenerator(function* (userData) {\n    var socket = io(ENDPOINT);\n    try {\n      var _yield$axios$post2 = yield axios.post(API_URL + 'users/login', userData),\n        data = _yield$axios$post2.data;\n      if (data) {\n        var user = yield AsyncStorage.setItem('user', JSON.stringify(data));\n        var user1 = yield AsyncStorage.getItem('user');\n        console.log(JSON.stringify(user1));\n        socket.emit('user_online', {\n          data: data,\n          socketID: socket.id\n        });\n        return data;\n      }\n    } catch (error) {\n      console.log(\"error in logging in\");\n    }\n  });\n  return function login(_x2) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nvar UpdateLastSeenAndStatus = function () {\n  var _ref3 = _asyncToGenerator(function* (userData) {\n    var user1 = yield AsyncStorage.getItem(\"user\");\n    var user = JSON.parse(user1);\n    try {\n      var _config = {\n        headers: {\n          Authorization: \"Bearer \" + user.token\n        }\n      };\n      var now = moment();\n      var UpdatedLastSeen = now.format();\n      yield axios.put('http://192.168.100.2:5000/api/users/stat', {\n        userId: userData.userId,\n        status: userData.status,\n        lastSeen: UpdatedLastSeen\n      }, _config);\n      console.log('user updated successfully');\n      yield AsyncStorage.removeItem('user');\n      var _yield$axios$get = yield axios.get(\"http://192.168.100.2:5000/api/users/ret/\" + userData.userId, _config),\n        data = _yield$axios$get.data;\n      var testuser = yield AsyncStorage.setItem('user', JSON.stringify(data));\n      var testuser1 = yield AsyncStorage.getItem('user');\n      var testuser2 = JSON.parse(testuser1);\n      return testuser2;\n    } catch (error) {\n      console.log(error);\n    }\n  });\n  return function UpdateLastSeenAndStatus(_x3) {\n    return _ref3.apply(this, arguments);\n  };\n}();\nvar getUserDetails = function () {\n  var _ref4 = _asyncToGenerator(function* (userId) {\n    console.log(userId + 'detailservice');\n    try {\n      var _yield$axios$get2 = yield axios.get(API_URL + \"users/\" + userId),\n        data = _yield$axios$get2.data;\n      console.log(\"new user dataaaaaaaaaaa:\", data);\n      if (data) {\n        return data;\n      } else {\n        console.log('error in authservice');\n      }\n    } catch (error) {\n      console.log(\"error in logging in\");\n    }\n  });\n  return function getUserDetails(_x4) {\n    return _ref4.apply(this, arguments);\n  };\n}();\nvar logout = function () {\n  var _ref5 = _asyncToGenerator(function* () {\n    yield AsyncStorage.removeItem('user');\n  });\n  return function logout() {\n    return _ref5.apply(this, arguments);\n  };\n}();\nvar getTravelers = function () {\n  var _ref6 = _asyncToGenerator(function* () {\n    console.log('traveler slice activated');\n    var response = yield axios.get(API_BASE_URL + \"travels/\", config);\n    console.log(response.data.data);\n    return response.data.data;\n  });\n  return function getTravelers() {\n    return _ref6.apply(this, arguments);\n  };\n}();\nvar getConsumers = function () {\n  var _ref7 = _asyncToGenerator(function* () {\n    console.log('buyer slice activated');\n    var response = yield axios.get(API_BASE_URL + \"buyers/\");\n    console.log(\"buyers areeeeeeeeee:\", response.data.data);\n    return response.data.data;\n  });\n  return function getConsumers() {\n    return _ref7.apply(this, arguments);\n  };\n}();\nvar authService = {\n  register: register,\n  logout: logout,\n  login: login,\n  getTravelers: getTravelers,\n  getConsumers: getConsumers,\n  getUserDetails: getUserDetails,\n  UpdateLastSeenAndStatus: UpdateLastSeenAndStatus\n};\nexport default authService;","map":{"version":3,"names":["axios","AsyncStorage","io","moment","API_BASE_URL","API_URL","ENDPOINT","register","userData","post","data","user","setItem","JSON","stringify","user1","getItem","console","log","error","response","login","socket","emit","socketID","id","UpdateLastSeenAndStatus","parse","config","headers","Authorization","token","now","UpdatedLastSeen","format","put","userId","status","lastSeen","removeItem","get","testuser","testuser1","testuser2","getUserDetails","logout","getTravelers","getConsumers","authService"],"sources":["/home/dagmawi/personal/borsa/ui/borsa-ui/src/features/auth/authService.js"],"sourcesContent":["import axios from 'axios'\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport io from 'socket.io-client'\nimport moment from 'moment';\nimport { API_BASE_URL } from '../../utils/config';\n\n// const API_URL = '/api/users/'\nconst API_URL = 'http://143.198.168.244/api/'\nconst ENDPOINT = \"http://192.168.100.2:5000\"\n// Register user\nconst register = async (userData) => {\n  const {data} = await axios.post(`${API_URL}users`, userData)\n  try{\n    if (data) {\n      const user = await AsyncStorage.setItem('user', JSON.stringify(data))\n      const user1 = await AsyncStorage.getItem('user')\n      console.log(JSON.stringify(user1))\n      return data;\n    }\n  }\n  catch(error){\n    console.log('cannot register user')\n  }\n  \n\n  return response.data\n}\n\n// Login user\nconst login = async (userData) => {\n  // console.log(userData)\n  var socket = io(ENDPOINT)\n  try{\n    const {data} = await axios.post(API_URL + 'users/login', userData)\n    // console.log(data)\n  \n    if (data) {\n      // localStorage.setItem('user', JSON.stringify(response.data))\n      const user = await AsyncStorage.setItem('user', JSON.stringify(data))\n      const user1 = await AsyncStorage.getItem('user')\n      console.log(JSON.stringify(user1))\n      socket.emit('user_online', { data, socketID : socket.id})\n      return data;\n      \n    }\n  }\n  \n  catch(error){\n    console.log(\"error in logging in\")\n  }\n\n \n}\nconst UpdateLastSeenAndStatus = async(userData) =>{\n  // console.log(`in updated slice of id ${userData}`)\n  const user1 = await  AsyncStorage.getItem(\"user\")\n  const user = JSON.parse(user1)\n  // console.log(userData.userId)\n  try{\n\n  \n  const   config = {\n      \n    headers: {\n     \n      Authorization: `Bearer ${user.token}`\n    },\n    // body: JSON.stringify({\n    //   imgsource: newPhoto.base64,\n    // }),\n    // body: formData\n   };\n   const now = moment()\n   const UpdatedLastSeen = now.format()\n   await axios.put('http://192.168.100.2:5000/api/users/stat', {\n    userId : userData.userId,\n    status: userData.status,\n    lastSeen : UpdatedLastSeen\n    \n    \n  },\n  config)\n  console.log('user updated successfully')\n  \n  await AsyncStorage.removeItem('user')\n   const {data} = await axios.get(`http://192.168.100.2:5000/api/users/ret/${userData.userId}`,\n  config)\n  const testuser = await AsyncStorage.setItem('user', JSON.stringify(data))\n    const  testuser1 = await AsyncStorage.getItem('user')\n    const  testuser2 = JSON.parse(testuser1)\n    return testuser2\n \n}\ncatch(error){\n  console.log(error)\n}\n   \n\n}\n\n// User Details\nconst getUserDetails = async (userId) => {\n  console.log(userId + 'detailservice')\n  try{\n    const {data} = await axios.get(`${API_URL}users/${userId}`)\n    \n    console.log(\"new user dataaaaaaaaaaa:\", data)\n  \n    if (data) {\n\n      return data;\n       \n    }\n    else {\n      console.log('error in authservice')\n    }\n  }\n  \n  catch(error){\n    console.log(\"error in logging in\")\n  }\n\n \n}\n\n// Logout user\nconst logout = async() => {\n  // localStorage.removeItem('user')\n  // var socket = io(ENDPOINT)\n  // socket.on('disconnect', (test))\n  await AsyncStorage.removeItem('user')\n\n  // await AsyncStorage.clear()\n  \n}\n\n// //get list of all travelers\nconst getTravelers = async () => {\n  console.log('traveler slice activated')\n  const response = await axios.get(`${API_BASE_URL}travels/`, config)\n  console.log(response.data.data)\n  return response.data.data\n}\n\n// //get list of all consumers\nconst getConsumers = async () => {\n  console.log('buyer slice activated')\n  const response = await axios.get(`${API_BASE_URL}buyers/`)\n  console.log(\"buyers areeeeeeeeee:\", response.data.data)\n\n  return response.data.data\n}\n\nconst authService = {\n  register,\n  logout,\n  login,\n  getTravelers,\n  getConsumers,\n  getUserDetails,\n  UpdateLastSeenAndStatus,\n  \n}\n\nexport default authService"],"mappings":"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"},"metadata":{},"sourceType":"module"}